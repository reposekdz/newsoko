<!DOCTYPE html>
<html>
<head>
    <title>Rwanda Locations Migration</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 900px; margin: 50px auto; padding: 20px; background: #f5f5f5; }
        .container { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; border-bottom: 3px solid #4CAF50; padding-bottom: 10px; }
        .btn { background: #4CAF50; color: white; padding: 12px 30px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
        .btn:hover { background: #45a049; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        #output { background: #1e1e1e; color: #00ff00; padding: 20px; border-radius: 5px; margin-top: 20px; font-family: 'Courier New', monospace; white-space: pre-wrap; max-height: 500px; overflow-y: auto; display: none; }
        .success { color: #4CAF50; font-weight: bold; }
        .error { color: #f44336; font-weight: bold; }
        .info { color: #2196F3; }
        .loading { display: inline-block; width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid #4CAF50; border-radius: 50%; animation: spin 1s linear infinite; margin-left: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ‡·ðŸ‡¼ Rwanda Complete Locations Migration</h1>
        <p>This will create and populate the Rwanda administrative divisions database:</p>
        <ul>
            <li><strong>5 Provinces</strong></li>
            <li><strong>30 Districts</strong></li>
            <li><strong>416 Sectors</strong></li>
        </ul>
        <p>The migration will also update the <code>users</code> and <code>products</code> tables to include location fields.</p>
        
        <button id="runBtn" class="btn" onclick="runMigration()">Run Migration</button>
        <button class="btn" onclick="window.location.href='install_locations.php'" style="background:#2196F3;">Direct Install (Recommended)</button>
        <span id="loading" style="display:none;" class="loading"></span>
        
        <div id="output"></div>
    </div>

    <script>
        async function runMigration() {
            const btn = document.getElementById('runBtn');
            const output = document.getElementById('output');
            const loading = document.getElementById('loading');
            
            btn.disabled = true;
            loading.style.display = 'inline-block';
            output.style.display = 'block';
            output.innerHTML = '<span class="info">Starting migration...</span>\n\n';
            
            try {
                const response = await fetch('run_rwanda_locations.php');
                const text = await response.text();
                
                output.innerHTML = text
                    .replace(/âœ“/g, '<span class="success">âœ“</span>')
                    .replace(/âœ—/g, '<span class="error">âœ—</span>')
                    .replace(/Error:/g, '<span class="error">Error:</span>')
                    .replace(/Migration Summary:/g, '<span class="success">Migration Summary:</span>')
                    .replace(/Migration completed successfully!/g, '<span class="success">Migration completed successfully!</span>');
                
                if (text.includes('Migration completed successfully')) {
                    output.innerHTML += '\n\n<span class="success">âœ“ All done! You can now use the location system in your application.</span>';
                }
            } catch (error) {
                output.innerHTML += '<span class="error">âœ— Error: ' + error.message + '</span>';
            } finally {
                btn.disabled = false;
                loading.style.display = 'none';
            }
        }
    </script>
</body>
</html>
